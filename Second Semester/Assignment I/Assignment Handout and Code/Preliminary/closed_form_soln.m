clear 
clc 

N=20;
T_i=0:N+1; % Times T_0 to T_{N+1}
% Bond prices for T_0 to T_{N+1}
Bstar=[1.000000000000000 0.931733068514009 0.867336864194859 0.807180507606257 0.751390186399840 ...
0.699924481765438 0.652631479135652 0.609290924427683 0.569644566898682 0.533417438303370 ...
0.500332340416184 0.470119346466237 0.442521711052162 0.417299242183633 0.394229917259718 ...
0.373110314043405 0.353755267713142 0.335997045644106 0.319684243642614 0.304680543400063 ...
0.290863424934260 0.278122895071373];

% Caplet prices with strike K=0.05 and maturities T_1 to T_{N-1}
Caplets=[0.022922737518613 0.023535825778635 0.023194289857391 0.022294316394003 0.021086407641792 ...
0.019728461392470 0.018320943715610 0.016927232296721 0.015586172322853 0.014320233052482 ...
0.013140971196705 0.012052749925964 0.011055287463489 0.010145403965974 0.009318213062292 ...
0.008567926766803 0.007888391002214 0.007273433858145 0.006717084341419];

% Forward Rates 
F = griddedInterpolant(T_i,-log(Bstar),'linear'); 
Ti_trunc = 1:N; 
delta = 0.00000000001;  
r0 = 0.07; 
fwd_rates = [r0, (F(Ti_trunc + delta) - F(Ti_trunc - delta))/(2*delta)]; 
Ti = [1 10 19]; 
alpha = 0.15; 
sigma = 0.05; 
temp = [CapletAnalytical(Bstar,fwd_rates,Ti,0.03,r0,alpha,sigma); 
 CapletAnalytical(Bstar,fwd_rates,Ti,0.05,r0,alpha,sigma); 
 CapletAnalytical(Bstar,fwd_rates,Ti,0.07,r0,alpha,sigma)]
round(temp,5); 
x0 = [0.6 0.7]; 
fun =@(x) CaliObjective(Bstar,fwd_rates,Caplets,x);
value = fmincon(fun,x0); 
fun(value)

